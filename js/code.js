system42.on("apps:ready",(function(e){"use strict";e._apps.code={categories:"Development;TextEditor",name:"CodeMirror",type:"Editors",icon:"apps/codemirror.png",accept:"text/*,.txt,.js,.json,.html,.htm,.css,.md,.nfo,.php,.diz,.svg,.xml,.rss,.lnk42",exec:function(e,r){r||(r=e,e="");var t=this,o=$extend({},r);o.url&&delete o.url,$loader(["/c/libs/codemirror/lib/codemirror.js","/c/libs/codemirror/keymap/sublime.js","/c/libs/codemirror/mode/css/css.js","/c/libs/codemirror/mode/javascript/javascript.js","/c/libs/codemirror/addon/selection/active-line.js","/c/libs/codemirror/mode/xml/xml.js","/c/libs/codemirror/lib/codemirror.css","/c/libs/codemirror/theme/monokai.css"],(function(r){var i,s=0,n=0,c=e?e.replace(/:(\d+)(?::(\d+))?$/,(function(e,r,t){return s=r||0,n=t||0,""})):"",l="<strong>Keymap</strong><br><br><table>";$io.obj.all(CodeMirror.keyMap.sublime,(function(e,r){if("fallthrough"!==r){var t=e.replace(/[A-Z]/g,(function(e){return" "+e.toLowerCase()}));t=t.charAt(0).toUpperCase()+t.slice(1),l+="<tr><td>"+t+"</td><td> : "+r+"</td></tr>"}})),l+="</table>",$editor.call(t,{type:"String",filePath:c,help:{instructions:l,about:{msg:'<b>CodeMirror</b> is a versatile text editor implemented in JavaScript for the browser.<br><b>Copyright (C) 2015 by Marijn Haverbeke</b><br>MIT license<br><a href="http://codemirror.net" target="_blank">codemirror.net</a>',img:"/c/libs/codemirror/doc/logo.png"}},create:function(e){function r(){setTimeout((function(){i.refresh()}),1),setTimeout((function(){i.refresh()}),10),setTimeout((function(){i.refresh()}),100),setTimeout((function(){i.refresh()}),500),setTimeout((function(){i.refresh()}),1e3),setTimeout((function(){i.refresh()}),1500)}return i=CodeMirror(e,{theme:"monokai",mode:"text/x-markdown",lineWrapping:!0,lineNumbers:!0,indentUnit:2,keyMap:"sublime",styleActiveLine:!0}),$el(i).click(),i.focus(),{readFile:function(e){var t=this.mime;c=this.path;var o=this.ext;"xml"!=o&&"rss"!=o||(t="xml"),/json/.test(t)&&(t="application/json"),i.setOption("mode",t),i.setValue("string"==typeof e?e:JSON.stringify(e)),r(),i.setCursor({line:s-1,ch:n-1});var l=i.getScrollInfo().clientHeight,a=i.charCoords({line:s-1,ch:n-1},"local");i.scrollTo(null,(a.top+a.bottom-l)/2),setTimeout((function(){i.focus()}),100)},setValue:function(e){i.setValue(e),r()},getValue:function(e){e(i.getValue())}}},window:$extend({height:345,width:435,bodyClass:"ui_texteditor skin_inset_deep",onresize:function(){i.refresh()}},o)})}))}}}));